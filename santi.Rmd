---
  title: "Santi"
author: "Santythegreat"
output: html_document
---
  
  ```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data Load ## 

```{r}
price = read.csv("price.csv")
review = read.csv("review.csv")
price.t = read.csv("price_test.csv")
review.t = read.csv("review_test.csv")
```

## Regression Task 1 ## 

```{r}
# head(price)
# colnames(price)
```

## Data Pre-processing ## 

```{r}
price.pre = price
price.pre$host_is_superhost = as.factor(as.numeric(price.pre$host_is_superhost) -1)
price.pre$host_identity_verified = as.factor(as.numeric(price.pre$host_identity_verified) -1)
price.pre$instant_bookable = as.factor(as.numeric(price.pre$instant_bookable) -1)
price.pre$host_response_rate = as.numeric(sub("%", "", price.pre$host_response_rate)) / 100
price.pre$host_response_time = as.factor(unclass(price.pre$host_response_time) -1)
price.pre$cleaning_fee = as.numeric(sub("$", "", price.pre$cleaning_fee, fixed = T))
price.pre$price = as.numeric(gsub("$", "", price.pre$price, fixed = T))
price.pre$cancellation_policy = as.factor(as.numeric(price.pre$cancellation_policy))

# head(price.pre)
# sum(is.na(price.pre))
```

## Train/Test Split ## 

** Split 70/30 ** 
  
  ```{r}
# n <- nrow(price.pre)
# sample.price <- price.pre[sample(n), ]
# train.indices <- 1:round(0.7 * n)
# train <- sample.price[train.indices,]
# test.indices <- (round(0.7 * n) + 1):n
# test <- sample.price[test.indices,]
```

## Initial Modeling ## 

** MLR ** 
  
  ```{r}
# train.lm = train[, -c(9,19)]
# mlr = lm(price~., data = train.lm)
# summary(mlr)
# predictions.mlr = predict(mlr, newdata = test)
# mse.mlr = mean((test$price - predictions.mlr)^2) 
```













## Cleaning Amenities ##

```{r}
# library(stringr)
# library(container)

# d <- Dict$new()


# for (i in c(1:length(price.pre$amenities))) {
# for (i in c(1:2)) {
#   s = toString(price.pre$amenities[i])
#   s = strsplit(s,",")
#   newS = str_replace(s[[1]],'\\{',"")
#   newS = str_replace(newS,'\\}',"")
#   newS = str_replace(newS,'\"',"")
#   newS = str_replace(newS,'\"',"")
#   newS = tolower(newS)
#   print(newS)
#   
# print(length(newS))

# for (j in c(1:length(newS))) {
# if (length(newS[j]) != 1) {print("YO")}
# print(length(newS[j]))
# if (d$has(newS[j])) {
#   v = d$peek(newS[j])
#   d$discard(newS[j])$values()
#   d$add(newS[j],c + 1)
# }
# else {
#   # if (length(newS[j]) == 0) {
#   #   print("LENGTH 0")
#   #   break
#   # }
#   d$add(newS[j],1)
# }
# }
# }

# # table(sapply(price.pre[1,"amenities"], FUN=function(x) {
# table(sapply(c("cat","dog","elephant"]), FUN=function(x) {
# # some function that just splits up all the words in each row of amenities
#   s = toString(x)
#   # s = strsplit(s[[1]],",")
#   # newS = str_replace(s,'\\{',"")
#   # newS = str_replace(newS,'\\}',"")
#   # newS = str_replace(newS,'\"',"")
#   # newS = str_replace(newS,'\"',"")
#   # tolower(newS)
# }))

# head(price.pre$amenities)
```

```{r}
v = sapply(price.pre$amenities, FUN=function(x) {
  # some function that just splits up all the words in each row of amenities
  s = toString(x)
  s = strsplit(s[[1]],",")
  newS = str_replace(s[[1]],'\\{',"")
  newS = str_replace(newS,'\\}',"")
  newS = str_replace(newS,'\"',"")
  newS = str_replace(newS,'\"',"")
  tolower(newS)
})
```

```{r}
l = c()
for (i in c(1:length(price.pre$amenities))) {
  g = v[[i]]
  l = c(l,g)
}
t = sort(table(l),decreasing = TRUE)
t[1:30]
```